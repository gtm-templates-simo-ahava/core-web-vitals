___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Core Web Vitals",
  "categories": [
    "UTILITY"
  ],
  "__wm": "VGVtcGxhdGUtQXV0aG9yX0NvcmVXZWJWaXRhbHMtU2ltby1BaGF2YQ\u003d\u003d",
  "brand": {
    "id": "github.com_gtm-templates-simo-ahava",
    "displayName": "gtm-templates-simo-ahava",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Load the Core Web Vitals library from a CDN and have it push key milestones (CLS, FID, LCP) into dataLayer for use in tags.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "config",
    "displayName": "Configuration",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "namespace",
        "checkboxText": "Namespace Objects",
        "simpleValueType": true,
        "defaultValue": false,
        "help": "If you check this option, then each measurement will be nested under its own property in the webVitalsMeasurement dataLayer object. If you leave this option unchecked, then each measurement will use a shared set of object properties (and thus overwrite previous values)."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "info",
    "displayName": "Information",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "LABEL",
        "name": "Info",
        "displayName": "This template adds measurement handlers for the three \u003ca href\u003d\"https://web.dev/vitals/\" target\u003d\"_blank\"\u003ecore web vitals\u003c/a\u003e of \u003cstrong\u003eLCP\u003c/strong\u003e (Largest Contentful Paint), \u003cstrong\u003eFID\u003c/strong\u003e (First Input Delay), and \u003cstrong\u003eCLS\u003c/strong\u003e (Cumulative Layout Shift). See \u003ca href\u003d\"https://www.simoahava.com/custom-templates/core-web-vitals/\" target\u003d\"_blank\"\u003ethis guide\u003c/a\u003e for instructions on how to use this template."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Load template APIs
const copyFromWindow = require('copyFromWindow');
const createQueue = require('createQueue');
const injectScript = require('injectScript');
const log = require('logToConsole');
const Math = require('Math');

const dataLayerPush = createQueue('dataLayer');

// Helper for failure handling
const fail = msg => {
  log(msg);
  data.gtmOnFailure();
};

// Process the web vitals object and push to dataLayer
const process = obj => {
  const dlObj = {event: 'coreWebVitals', webVitalsMeasurement: {}};
  const cwvObj = {
    name: obj.name,
    id: obj.id,
    value: obj.value,
    delta: obj.delta,
    valueRounded: Math.round(obj.name === 'CLS' ? obj.value * 1000 : obj.value),
    deltaRounded: Math.round(obj.name === 'CLS' ? obj.delta * 1000 : obj.delta)
  };
  if (data.namespace) {
    // If namespaced, add the measurement under the name of the measurement
    dlObj.webVitalsMeasurement[obj.name] = cwvObj;
  } else {
    // If not namespaced, add the measurement directly into webVitalsMeasurement
    dlObj.webVitalsMeasurement = cwvObj;
  }
  dataLayerPush(dlObj);
};

// Set the handlers
const setMilestones = () => {
  const wv = copyFromWindow('webVitals');
  if (!wv) return fail('[GTM / Core Web Vitals]: window.webVitals failed to load.');
  wv.getFID(process);
  wv.getCLS(process);
  wv.getLCP(process);
  data.gtmOnSuccess();
};

// Load the library
injectScript('https://unpkg.com/web-vitals/dist/web-vitals.iife.js', setMilestones, data.gtmOnFailure, 'web-vitals');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "webVitals"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://unpkg.com/web-vitals/dist/web-vitals.iife.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Main test
  code: "let success, failure;\nlet milestoneCount = 0;\nmock('createQueue', q =>\
    \ {\n  return (obj) => {\n    if (obj.webVitalsMeasurement.id === 'LCP') assertThat(obj,\
    \ 'incorrect LCP object pushed to dataLayer').isEqualTo({\n      event: 'coreWebVitals',\n\
    \      webVitalsMeasurement: {\n        id: 'LCP',\n        name: 'LCP',\n   \
    \     value: 1.23,\n        delta: 1.55,\n        valueRounded: 1,\n        deltaRounded:\
    \ 2\n      }\n    });\n    if (obj.webVitalsMeasurement.id === 'FID') assertThat(obj,\
    \ 'incorrect FID object pushed to dataLayer').isEqualTo({\n      event: 'coreWebVitals',\n\
    \      webVitalsMeasurement: {\n        id: 'FID',\n        name: 'FID',\n   \
    \     value: 1.23,\n        delta: 1.55,\n        valueRounded: 1,\n        deltaRounded:\
    \ 2\n      }\n    });\n    if (obj.webVitalsMeasurement.id === 'CLS') assertThat(obj,\
    \ 'incorrect CLS object pushed to dataLayer').isEqualTo({\n      event: 'coreWebVitals',\n\
    \      webVitalsMeasurement: {\n        id: 'CLS',\n        name: 'CLS',\n   \
    \     value: 0.00123,\n        delta: 0.00155,\n        valueRounded: 1,\n   \
    \     deltaRounded: 2\n      }\n    });\n  };\n});\n\nmock('injectScript', (url,\
    \ onsuccess, onfailure, id) => {\n  success = onsuccess;\n  failure = onfailure;\n\
    \  onsuccess();\n});\n\nmock('copyFromWindow', globalVar => {\n  assertThat(globalVar,\
    \ 'Incorrect global variable loaded from window').isEqualTo('webVitals');\n  return\
    \ {\n    getCLS: (cb) => { milestoneCount++; cb({name: 'CLS', id: 'CLS', value:\
    \ 0.00123, delta: 0.00155, valueRounded: 1, deltaRounded: 2}); },\n    getLCP:\
    \ (cb) => { milestoneCount++; cb({name: 'LCP', id: 'LCP', value: 1.23, delta:\
    \ 1.55, valueRounded: 1, deltaRounded: 2}); },\n    getFID: (cb) => { milestoneCount++;\
    \ cb({name: 'FID', id: 'FID', value: 1.23, delta: 1.55, valueRounded: 1, deltaRounded:\
    \ 2}); }\n  };\n});\n \n// Call runCode to run the template's code.\nrunCode({});\n\
    \n// Verify that the tag finished successfully.\nassertApi('injectScript').wasCalledWith('https://unpkg.com/web-vitals/dist/web-vitals.iife.js',\
    \ success, failure, 'web-vitals');\nassertThat(milestoneCount, 'webVitals called\
    \ incorrect number of times').isEqualTo(3);\nassertApi('gtmOnSuccess').wasCalled();"
- name: Namespace test
  code: "let success, failure;\nlet milestoneCount = 0;\nlet lcpPushed, fidPushed,\
    \ clsPushed;\nmock('createQueue', q => {\n  return (obj) => {\n    if (obj.webVitalsMeasurement.LCP)\
    \ {\n      assertThat(obj, 'incorrect LCP object pushed to dataLayer').isEqualTo({\n\
    \        event: 'coreWebVitals',\n        webVitalsMeasurement: {\n          LCP:\
    \ {\n            id: 'LCP',\n            name: 'LCP',\n            value: 1.23,\n\
    \            delta: 1.55,\n            valueRounded: 1,\n            deltaRounded:\
    \ 2\n          }\n        }\n      });\n      lcpPushed = true;\n    }\n    if\
    \ (obj.webVitalsMeasurement.FID) {\n      assertThat(obj, 'incorrect FID object\
    \ pushed to dataLayer').isEqualTo({\n        event: 'coreWebVitals',\n       \
    \ webVitalsMeasurement: {\n          FID: {\n            id: 'FID',\n        \
    \    name: 'FID',\n            value: 1.23,\n            delta: 1.55,\n      \
    \      valueRounded: 1,\n            deltaRounded: 2\n          }\n        }\n\
    \      });\n      fidPushed = true;\n    }\n    if (obj.webVitalsMeasurement.CLS)\
    \ {\n      assertThat(obj, 'incorrect CLS object pushed to dataLayer').isEqualTo({\n\
    \        event: 'coreWebVitals',\n        webVitalsMeasurement: {\n          CLS:\
    \ {\n            id: 'CLS',\n            name: 'CLS',\n            value: 0.00123,\n\
    \            delta: 0.00155,\n            valueRounded: 1,\n            deltaRounded:\
    \ 2\n          }\n        }\n      });\n      clsPushed = true;\n    }\n  };\n\
    });\n\nmock('injectScript', (url, onsuccess, onfailure, id) => {\n  success =\
    \ onsuccess;\n  failure = onfailure;\n  onsuccess();\n});\n\nmock('copyFromWindow',\
    \ globalVar => {\n  assertThat(globalVar, 'Incorrect global variable loaded from\
    \ window').isEqualTo('webVitals');\n  return {\n    getCLS: (cb) => { milestoneCount++;\
    \ cb({name: 'CLS', id: 'CLS', value: 0.00123, delta: 0.00155, valueRounded: 1,\
    \ deltaRounded: 2}); },\n    getLCP: (cb) => { milestoneCount++; cb({name: 'LCP',\
    \ id: 'LCP', value: 1.23, delta: 1.55, valueRounded: 1, deltaRounded: 2}); },\n\
    \    getFID: (cb) => { milestoneCount++; cb({name: 'FID', id: 'FID', value: 1.23,\
    \ delta: 1.55, valueRounded: 1, deltaRounded: 2}); }\n  };\n});\n \n// Call runCode\
    \ to run the template's code.\nrunCode({namespace: true});\n\n// Verify that the\
    \ tag finished successfully.\nassertApi('injectScript').wasCalledWith('https://unpkg.com/web-vitals/dist/web-vitals.iife.js',\
    \ success, failure, 'web-vitals');\nassertThat(milestoneCount, 'webVitals called\
    \ incorrect number of times').isEqualTo(3);\nassertThat(lcpPushed, 'LCP object\
    \ not pushed into dataLayer').isEqualTo(true);\nassertThat(fidPushed, 'FID object\
    \ not pushed into dataLayer').isEqualTo(true);\nassertThat(clsPushed, 'CLS object\
    \ not pushed into dataLayer').isEqualTo(true);\nassertApi('gtmOnSuccess').wasCalled();"
setup: ''


___NOTES___

Created on 21/01/2021, 11:32:35


